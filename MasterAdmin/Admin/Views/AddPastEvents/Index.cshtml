@{
    ViewBag.Title = "Past Events";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@model List<Admin.Models.tblPastEvent>
<script src="~/App_Scripts/jquery.validate.js"></script>

<script type="text/javascript">
    $(function () {

        $('#datatable').DataTable({
            "order": [[1, "asc"]]
        });

        $("#frmEvent").validate({
            rules: {
                drpYear: {
                    required: true
                },
                drpMonth: {
                    required: true
                },
                txtEventName: {
                    required: true,
                },
                txtFile: {
                    required: true,
                }
            },
            messages: {
                drpYear: {
                    required: "Please select year"
                },
                drpMonth: {
                    required: "Please select month"
                },
                txtEventName: {
                    required: "Please enter event name",
                },
                txtFile: {
                    required: "Select atleast one file",
                }
            },
            errorPlacement: function (error, element) {
                if (element.attr("name") == "drpYear")
                    error.appendTo($('#lblYear'));

                if (element.attr("name") == "drpMonth")
                    error.appendTo($('#lblMonth'));

                if (element.attr("name") == "txtEventName")
                    error.appendTo($('#lblEventName'));

                if (element.attr("name") == "txtFile")
                    error.appendTo($('#lblFile'));
            }
        });


    });


    function UploadFiles() {
        if ($("#frmEvent").valid()) {
            $("#but_upload").hide();
            $("#but_loader").show();

            var data;
            data = new FormData();
            data.append('txtEventName', $("#txtEventName").val());
            data.append('drpYear', $("#drpYear").val());
            data.append('drpMonth', $("#drpMonth").val());

            var files = document.getElementById("txtFile").files;

            if (files.length > 0) {
                for (var i = 0; i < files.length; i++) {
                    data.append('txtFile_' + i, files[i])
                }
            }

            if (data != null) {
                $.ajax({
                    url: "/AddPastEvents/UploadFiles",
                    data: data,
                    type: "POST",
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        if (response == "OK") {
                            alert("Images added successfully.");
                            location.reload();
                        }
                        else {
                            alert("Sorry, something went wrong. Please try again after sometime.")
                            $("#but_loader").hide();
                            $("#but_upload").show();
                        }
                    }
                });
            }
        }
        else
            return false;
    }

    function DeleteImage(id) {
        var c = confirm("Are you sure you want to delete this image?");

        if (c) {
            $.ajax({
                url: "/AddPastEvents/DeleteImage?id=" + id,
                type: "GET",
                success: function (response) {
                    if (response == "OK") {
                        alert("Image deleted successfully.");
                        location.reload();
                    }
                }
            });
        }
    }
</script>


<form id="frmEvent">
    <div class="row">
        <div class="col-sm-12">
            <div class="MainHeader">Manage Past Events</div>
        </div>

        <div class="col-sm-3"><div class="FormLabelStyle">Year</div></div>
        <div class="col-sm-5">
            <select type="text" class="FormTxtStyle" id="drpYear" name="drpYear">
                <option value="">--Select Year--</option>
                <option value="2015">2015</option>
                <option value="2016">2016</option>
                <option value="2017">2017</option>
                <option value="2018">2018</option>
                <option value="2019">2019</option>
                <option value="2020">2020</option>
            </select>
        </div>
        <div class="col-sm-4"><div class="FormValidationStyle" id="lblYear"></div></div>
        <div class="col-sm-12"><br /></div>

        <div class="col-sm-3"><div class="FormLabelStyle">Month</div></div>
        <div class="col-sm-5">
            <select type="text" class="FormTxtStyle" id="drpMonth" name="drpMonth">
                <option value="">--Select Month--</option>
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
            </select>
        </div>
        <div class="col-sm-4"><div class="FormValidationStyle" id="lblMonth"></div></div>
        <div class="col-sm-12"><br /></div>




        <div class="col-sm-3"><div class="FormLabelStyle">Event Name</div></div>
        <div class="col-sm-5"><input type="text" class="FormTxtStyle" id="txtEventName" name="txtEventName" /></div>
        <div class="col-sm-4"><div class="FormValidationStyle" id="lblEventName"></div></div>
        <div class="col-sm-12"><br /></div>


        <div class="col-sm-3"><div class="FormLabelStyle">Upload Images</div></div>
        <div class="col-sm-5"><input type="file" class="FormTxtStyle" id="txtFile" name="txtFile" multiple /></div>
        <div class="col-sm-4"><div class="FormValidationStyle" id="lblFile"></div></div>
        <div class="col-sm-12"><br /></div>

        <div class="col-sm-3"><div class="FormLabelStyle"></div></div>
        <div class="col-sm-5"><button class="FormBtnStyle" type="button" id="but_upload" onclick="UploadFiles();">Upload Images</button><img id="but_loader" src="~/App_Images/loader.gif" style="height:20px!important;width:20px!important;display:none;" /></div>
        <div class="col-sm-4"><div class="FormValidationStyle"></div></div>
        <div class="col-sm-12"><br /></div>
    </div>
</form>

<div class="FormBlock">
    <div class="row">
        <div class="col-sm-12">
            <div class="MainHeader">List of Past Events</div>
        </div>

        <div class="col-sm-12">
            <div class="underline"></div>
        </div>
    </div>

    <div class="row">

        <div class="col-sm-12">

            <table id="datatable" class="table table-striped table-bordered" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th><center>Sr No</center></th>
                        <th><center>Event Name</center></th>
                        <th><center>Year</center></th>
                        <th><center>Month</center></th>
                        <th><center>Action</center></th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int i = 0;
                    }
                    @foreach (var evt in Model)
                    {
                        i++;
                        
                        <tr>
                           <td><center>@i</center></td>
                           <td><center>@evt.EventName</center></td>
                            <td><center>@evt.Year</center></td>
                            <td><center>@evt.Month</center></td>
                           <td><center><a onclick="DeleteImage('@evt.PastEventID')">Delete</a></center></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
