
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@model List<Admin.Models.tblEventArtist>

<script src="~/App_Scripts/jquery.validate.js"></script>
<script src="~/App_Scripts/ckeditor/ckeditor.js"></script>

<link href="~/App_Theme/datatables-bootstrap.css" rel="stylesheet" />
<script src="~/App_Scripts/datatables.js"></script>

<script type="text/javascript">
    $(function () {

        $('#datatable').DataTable();

        $("#frmEvent").validate({
            rules: {
                txtEventName: {
                    required: true
                },
                txtEventType: {
                    required: true
                },
                txtEventLanguage: {
                    required: true
                },
                txtEventPlaytime: {
                    required: true
                },
                txtShowTime: {
                    required: true
                },
                txtEventDate: {
                    required: true
                }
            },
            messages: {
                txtEventName: {
                    required: "Please enter event name"
                },
                txtEventType: {
                    required: "Please enter event type"
                },
                txtEventLanguage: {
                    required: "Please enter event language"
                },
                txtEventPlaytime: {
                    required: "Please enter event play time"
                },

                txtShowTime: {
                    required: "Please enter event start date"
                },
                txtEventDate: {
                    required: "Please enter event date"
                }
            },
            errorPlacement: function (error, element) {
                if (element.attr("name") == "txtEventName")
                    error.appendTo($('#lblEventName'));

                if (element.attr("name") == "txtEventType")
                    error.appendTo($('#lblEventType'));

                if (element.attr("name") == "txtEventLanguage")
                    error.appendTo($('#lblEventLanguage'));

                if (element.attr("name") == "txtEventPlaytime")
                    error.appendTo($('#lblEventPlaytime'));

                if (element.attr("name") == "txtEventDate")
                    error.appendTo($('#lblEventDate'));

                if (element.attr("name") == "txtShowTime")
                    error.appendTo($('#lblShowTime'));
            }
        });

    });

    function GetArtist(id) {
        $.ajax({
            url: "/Events/GetArtist",
            data: { artistID: id },
            type: "POST",
            success: function (response) {
                $("#txtEventID").val(response.EventID);
                $("#txtArtistID").val(response.ArtistID);
                $("#txtArtistName").val(response.ArtistName);
            }
        });
    }


    function ManageArtist() {
        if ($("#frmArtist").valid()) {

            $("#but_upload").hide();
            $("#but_loader").show();

            var data;
            data = new FormData();

            data.append('txtArtistID', $("#txtArtistID").val());
            data.append('txtEventID', $("#txtEventID").val());
            data.append('txtArtistName', $("#txtArtistName").val());

            if ($('#txtArtistImage')[0].files[0] != null && $('#txtArtistImage')[0].files[0] != undefined)
                data.append('txtArtistImage', $('#txtArtistImage')[0].files[0]);

            $.ajax({
                url: '/Events/ManageArtists',
                data: data,
                type: 'POST',
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response == "i") {
                        alert("Artist created successfully.");
                        location.reload();
                    }
                    else if (response == "u") {
                        alert("Artist updated successfully.");
                        location.reload();

                        $("#but_loader").hide();
                        $("#but_upload").show();
                    }
                    else {
                        alert("Oops! Something went wrong. Please try again after sometime.");

                        $("#but_loader").hide();
                        $("#but_upload").show();
                    }
                }
            });
        }
        else {
            return false;
        }
    }

    function DeleteArtist(id) {
        var c = confirm("Are you sure you want to delete this artist?");

        if(c) {
            $.ajax({
                url: "/Events/DeleteArtist",
                data: { id: id },
                type: "GET",
                success: function(response) {
                    if(response == "OK") {
                        alert("Artist deleted successfully.");
                        location.reload();
                    }
                    else {
                        alert("Sorry, Something went wrong. Please try again after sometime.");

                    }
                }
            });
        }
    }

    
</script>

<div class="FormBlock">
    <form id="frmArtist">
        <div class="row">
            <div class="col-sm-12">
                <div class="MainHeader">Manage Artists</div>
            </div>

            <input type="hidden" class="FormTxtStyle" id="txtEventID" name="txtEventID" value="@Request["eventID"]" />
            <input type="hidden" class="FormTxtStyle" id="txtArtistID" name="txtArtistID" value="0" />
            @*Event Name*@
            <div class="col-sm-3"><div class="FormLabelStyle">Artist Name</div></div>
            <div class="col-sm-5"><input type="text" class="FormTxtStyle" id="txtArtistName" name="txtArtistName" /></div>
            <div class="col-sm-4"><div class="FormValidationStyle" id="lblEventLanguage"></div></div>
            <div class="col-sm-12"><br /></div>

            @*Event Name*@
            <div class="col-sm-3"><div class="FormLabelStyle">Image</div></div>
            <div class="col-sm-5"><input type="file" class="FormTxtStyle" id="txtArtistImage" name="txtArtistImage" /></div>
            <div class="col-sm-4"><div class="FormValidationStyle" id="lblImage"></div></div>
            <div class="col-sm-12"><br /></div>

            <div class="col-sm-4" id="block_div_3" style="display:none;"><div class="FormValidationStyle" id="lblEventTNC"></div></div>
            @*Event Name*@
            <div class="col-sm-3"><div class="FormLabelStyle"></div></div>
            <div class="col-sm-5"><button class="FormBtnStyle" type="button" onclick="JavaScript: ManageArtist();" id="but_upload">Update Artist</button><img id="but_loader" src="~/App_Images/loader.gif" style="height:20px!important;width:20px!important;display:none;" /></div>
            <div class="col-sm-4"><div class="FormValidationStyle"></div></div>
            <div class="col-sm-12"><br /></div>

        </div>
    </form>
</div>

<div class="row">



    <div class="col-sm-12">
        <div class="HeadLabel">List of Artists</div>
    </div>

    <div class="col-sm-12">
        <div class="underline"></div>
    </div>
</div>

<div class="row">

    <div class="col-sm-12">

        <table id="datatable" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th><center>Artist Name</center></th>
                    <th><center>Action</center></th>
                </tr>
            </thead>

            <tbody>
                @foreach (var evt in Model)
                {
                    <tr class="dynamic">
                        <td><center>@evt.Name</center></td>
                        <td><center><a href="JavaScript:;" onclick="JavaScript:GetArtist(@evt.ArtistID)">View Artist</a>&nbsp;||&nbsp;<a href="JavaScript:;" onclick="JavaScript:DeleteArtist(@evt.ArtistID)">Delete Artist</a></center> </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
</div>
